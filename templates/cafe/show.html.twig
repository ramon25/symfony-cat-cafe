{% extends 'base.html.twig' %}

{% block title %}{{ cat.name }} - Whiskers & Wonders Cat Cafe{% endblock %}

{% block body %}
<div class="max-w-2xl mx-auto">
    <!-- Back Button -->
    <a href="{{ path('app_home') }}" class="inline-flex items-center text-orange-600 hover:text-orange-700 mb-6">
        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
        </svg>
        Back to all cats
    </a>

    {% if cat.adopted %}
    <div class="bg-green-100 border border-green-400 text-green-700 rounded-lg p-4 mb-6 flex items-center">
        <span class="text-2xl mr-3">üè†</span>
        <div>
            <p class="font-bold">This cat has found their forever home!</p>
            <p class="text-sm">Adopted on {{ cat.adoptedAt|date('F j, Y') }}</p>
        </div>
    </div>
    {% endif %}

    <!-- Cat Profile Card -->
    <div class="bg-white rounded-xl shadow-lg overflow-hidden">
        <!-- Header -->
        <div class="bg-gradient-to-r from-orange-400 to-amber-400 p-8 text-center">
            <span class="text-8xl mb-4 block">{{ cat.moodEmoji }}</span>
            <h1 class="text-4xl font-bold text-white">{{ cat.name }}</h1>
            <p class="text-orange-100 text-lg">{{ cat.breed }}</p>
        </div>

        <!-- Info -->
        <div class="p-6 space-y-6">
            <!-- Basic Info -->
            <div class="grid grid-cols-3 gap-4 text-center">
                <div class="p-4 bg-gray-50 rounded-lg">
                    <p class="text-2xl">üéÇ</p>
                    <p class="font-bold text-gray-800">{{ cat.age }} years</p>
                    <p class="text-sm text-gray-500">Age</p>
                </div>
                <div class="p-4 bg-gray-50 rounded-lg">
                    <p class="text-2xl">üé®</p>
                    <p class="font-bold text-gray-800">{{ cat.color }}</p>
                    <p class="text-sm text-gray-500">Color</p>
                </div>
                <div class="p-4 bg-gray-50 rounded-lg">
                    <p class="text-2xl">{{ cat.moodEmoji }}</p>
                    <p class="font-bold text-gray-800 capitalize">{{ cat.mood }}</p>
                    <p class="text-sm text-gray-500">Mood</p>
                </div>
            </div>

            {% if cat.description %}
            <div class="p-4 bg-orange-50 rounded-lg">
                <h3 class="font-bold text-gray-800 mb-2">About {{ cat.name }}</h3>
                <p class="text-gray-600">{{ cat.description }}</p>
            </div>
            {% endif %}

            <!-- Stats -->
            <div class="space-y-4">
                <h3 class="font-bold text-gray-800">Current Status</h3>

                <div>
                    <div class="flex justify-between text-sm mb-1">
                        <span class="flex items-center"><span class="mr-2">üçΩÔ∏è</span> Hunger</span>
                        <span class="font-semibold {% if cat.hunger > 70 %}text-red-600{% else %}text-gray-600{% endif %}">{{ cat.hunger }}%</span>
                    </div>
                    <div class="bg-gray-200 rounded-full h-4">
                        <div class="stat-bar bg-gradient-to-r from-red-300 to-red-500 rounded-full h-4 flex items-center justify-end pr-2"
                             style="width: {{ cat.hunger }}%">
                        </div>
                    </div>
                </div>

                <div>
                    <div class="flex justify-between text-sm mb-1">
                        <span class="flex items-center"><span class="mr-2">üòä</span> Happiness</span>
                        <span class="font-semibold {% if cat.happiness < 30 %}text-red-600{% else %}text-gray-600{% endif %}">{{ cat.happiness }}%</span>
                    </div>
                    <div class="bg-gray-200 rounded-full h-4">
                        <div class="stat-bar bg-gradient-to-r from-green-300 to-green-500 rounded-full h-4"
                             style="width: {{ cat.happiness }}%">
                        </div>
                    </div>
                </div>

                <div>
                    <div class="flex justify-between text-sm mb-1">
                        <span class="flex items-center"><span class="mr-2">‚ö°</span> Energy</span>
                        <span class="font-semibold {% if cat.energy < 20 %}text-red-600{% else %}text-gray-600{% endif %}">{{ cat.energy }}%</span>
                    </div>
                    <div class="bg-gray-200 rounded-full h-4">
                        <div class="stat-bar bg-gradient-to-r from-blue-300 to-blue-500 rounded-full h-4"
                             style="width: {{ cat.energy }}%">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cat Fortune Cookie Section -->
            <div class="border-t pt-6" data-controller="wisdom" data-wisdom-url-value="{{ path('app_cat_wisdom', {id: cat.id}) }}">
                <h3 class="font-bold text-gray-800 mb-4 flex items-center">
                    <span class="text-2xl mr-2">üîÆ</span>
                    Cat Fortune Cookie
                </h3>

                <div class="bg-gradient-to-r from-purple-50 to-indigo-50 rounded-xl p-6 text-center">
                    <p class="text-gray-600 mb-4">Ask {{ cat.name }} to share their ancient feline wisdom with you...</p>

                    <button type="button"
                            data-wisdom-target="button"
                            data-action="click->wisdom#getWisdom"
                            class="bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600 text-white font-bold py-3 px-6 rounded-lg transition-all flex items-center justify-center space-x-2 mx-auto shadow-md hover:shadow-lg">
                        <span class="text-xl">üîÆ</span>
                        <span>Ask for Wisdom</span>
                    </button>

                    <!-- Wisdom Display (initially hidden) -->
                    <div data-wisdom-target="display" class="hidden mt-6 space-y-4">
                        <div class="text-4xl" data-wisdom-target="emoji">{{ cat.moodEmoji }}</div>
                        <p class="text-gray-600 italic" data-wisdom-target="prefix"></p>
                        <p class="text-xl font-medium text-purple-800" data-wisdom-target="wisdom"></p>
                        <div class="text-sm text-gray-500 mt-4" data-wisdom-target="lucky"></div>
                    </div>
                </div>
            </div>

            <!-- AI Cat Therapist Section -->
            <div class="border-t pt-6"
                 data-controller="therapist"
                 data-therapist-url-value="{{ path('app_cat_therapy', {id: cat.id}) }}"
                 data-therapist-cat-name-value="{{ cat.name }}"
                 data-therapist-cat-emoji-value="{{ cat.moodEmoji }}">
                <h3 class="font-bold text-gray-800 mb-4 flex items-center">
                    <span class="text-2xl mr-2">üß†</span>
                    AI Cat Therapist
                    <span class="ml-2 text-xs bg-gradient-to-r from-purple-500 to-pink-500 text-white px-2 py-0.5 rounded-full">AI Powered</span>
                </h3>

                <div class="bg-gradient-to-r from-pink-50 to-purple-50 rounded-xl overflow-hidden shadow-inner">
                    <!-- Chat Header -->
                    <div class="bg-gradient-to-r from-pink-400 to-purple-400 px-4 py-3 flex items-center">
                        <span class="text-3xl mr-3">{{ cat.moodEmoji }}</span>
                        <div>
                            <p class="text-white font-bold">Dr. {{ cat.name }}</p>
                            <p class="text-pink-100 text-sm">Certified Cat Therapist</p>
                        </div>
                    </div>

                    <!-- Chat Messages Area -->
                    <div data-therapist-target="chatArea" class="h-64 overflow-y-auto p-4 space-y-2">
                        <div data-therapist-target="messages">
                            <!-- Messages will be added here dynamically -->
                        </div>
                    </div>

                    <!-- Chat Input -->
                    <form data-action="submit->therapist#sendMessage" class="border-t border-purple-100 p-3 bg-white/50">
                        <div class="flex gap-2">
                            <input type="text"
                                   data-therapist-target="input"
                                   data-action="keydown->therapist#handleKeydown"
                                   placeholder="Share what's on your mind..."
                                   class="flex-1 px-4 py-2 rounded-full border border-purple-200 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-transparent text-sm"
                                   autocomplete="off">
                            <button type="submit"
                                    data-therapist-target="submit"
                                    class="bg-gradient-to-r from-pink-500 to-purple-500 hover:from-pink-600 hover:to-purple-600 text-white px-4 py-2 rounded-full transition-all shadow-md hover:shadow-lg flex items-center gap-2 text-sm font-medium">
                                <span>Send</span>
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                                </svg>
                            </button>
                        </div>
                        <p class="text-xs text-purple-400 mt-2 text-center">Ask {{ cat.name }} for life advice from a cat's perspective!</p>
                    </form>
                </div>
            </div>

            {% if not cat.adopted %}
            <!-- Actions -->
            <div class="border-t pt-6">
                <h3 class="font-bold text-gray-800 mb-4">Interact with {{ cat.name }}</h3>

                <div class="grid grid-cols-2 gap-3">
                    <form action="{{ path('app_cat_feed', {id: cat.id}) }}" method="POST">
                        <button type="submit"
                                class="w-full bg-red-100 hover:bg-red-200 text-red-700 font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center space-x-2">
                            <span class="text-xl">üçΩÔ∏è</span>
                            <span>Feed</span>
                        </button>
                    </form>

                    <form action="{{ path('app_cat_pet', {id: cat.id}) }}" method="POST">
                        <button type="submit"
                                class="w-full bg-pink-100 hover:bg-pink-200 text-pink-700 font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center space-x-2">
                            <span class="text-xl">ü§ó</span>
                            <span>Pet</span>
                        </button>
                    </form>

                    <form action="{{ path('app_cat_play', {id: cat.id}) }}" method="POST">
                        <button type="submit"
                                class="w-full bg-yellow-100 hover:bg-yellow-200 text-yellow-700 font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center space-x-2">
                            <span class="text-xl">üß∂</span>
                            <span>Play</span>
                        </button>
                    </form>

                    <form action="{{ path('app_cat_rest', {id: cat.id}) }}" method="POST">
                        <button type="submit"
                                class="w-full bg-blue-100 hover:bg-blue-200 text-blue-700 font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center space-x-2">
                            <span class="text-xl">üò¥</span>
                            <span>Rest</span>
                        </button>
                    </form>
                </div>

                <!-- Adopt Button -->
                <form action="{{ path('app_cat_adopt', {id: cat.id}) }}" method="POST" class="mt-6">
                    <button type="submit"
                            onclick="return confirm('Are you sure you want to adopt {{ cat.name }}? This is a big responsibility!')"
                            class="w-full bg-gradient-to-r from-orange-500 to-amber-500 hover:from-orange-600 hover:to-amber-600 text-white font-bold py-4 px-6 rounded-xl transition-all text-lg flex items-center justify-center space-x-2 shadow-lg hover:shadow-xl">
                        <span class="text-2xl">üè†</span>
                        <span>Adopt {{ cat.name }}</span>
                    </button>
                </form>
            </div>
            {% endif %}

            <!-- Meta Info -->
            <div class="text-center text-sm text-gray-400 pt-4 border-t">
                Joined the cafe on {{ cat.createdAt|date('F j, Y') }}
            </div>
        </div>
    </div>
</div>
{% endblock %}
